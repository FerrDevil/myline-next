

server {
  listen 80;

  server_name _;
  server_tokens off;

  location /.well-known/acme-challenge/ {
      root /var/www/certbot;
  }

  location / {
      return 301 https://nextjs_upstream$request_uri;
  }
}

certbot:
    image: certbot/certbot:latest
    volumes:
      - ./certbot/www/:/var/www/certbot/:rw
        
  ssl_certificate /etc/letsencrypt/live/myline.clinic/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/myline.clinic/privkey.pem;
  include /etc/letsencrypt/options-ssl-nginx.conf;
  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
